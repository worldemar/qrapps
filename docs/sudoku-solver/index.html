<button id="l">LOCK</button> <button id="c">CLEAR</button><br><canvas><script>var s=e=>JSON.stringify(e),d=e=>JSON.parse(s(e)),o=(e,r)=>s(e)==s(r),c=e=>e.length,r=e=>document.getElementsByTagName(e)[0],t=e=>document.getElementById(e),l=(e,r,t)=>e.addEventListener(r,t),i=(e=(e,r)=>Array(e).fill(r))(9,e(9,0)),n=e(9,e(9,[1,2,3,4,5,6,7,8,9])),a=e(9,e(9,[])),u=d(i),y=d(i),h=d(n),f=(e,r)=>0!=u[e][r]?[u[e][r]]:0!=y[e][r]?[y[e][r]]:h[e][r],e=()=>{u=d(y)},i=()=>{y=d(u),h=d(a)},v=()=>(()=>{for(var e=0,r=0;r<3;r++)for(var t=0;t<3;t++){for(var l=[],i=3*t;i<3*t+3;i++)for(var n=3*r;n<3*r+3;n++)l.push(f(n,i));for(l=g(l,`quad ${r+1},`+(t+1)),i=3*t;i<3*t+3;i++)for(n=3*r;n<3*r+3;n++){var a=l.shift();o(h[n][i],a)||(e+=1),h[n][i]=a}}return e})()+p(!1)+p(!0),g=(e,r)=>{for(var t=c(e),l=d(e),i=0;i<t;i++)if(1==c(e[i]))for(var n,o=0;o<t;o++)o!=i&&-1<(n=l[o].indexOf(e[i][0]))&&l[o].splice(n,1);for(i=0;i<t;i++)if(1<c(e[i])){for(var a=0,f=[],o=0;o<t;o++)s(e[i])==s(e[o])&&(a+=1,f.push(o+1));for(var m=d(e[i]),o=0;o<t;o++)a>=c(m)&&s(l[o])!=s(m)&&(l[o]=l[o].filter(e=>m.indexOf(e)<0)),a>c(m)&&s(e[o])==s(m)&&(l[o]=[])}return l},p=e=>{for(var r=0,t=0;t<9;t++){for(var l=[],i=0;i<9;i++)l.push(e?f(t,i):f(i,t));for(l=g(l,(e?"column ":"row ")+(t+1)),i=0;i<9;i++){var n=l.shift();o(e?h[t][i]:h[i][t],n)||(r+=1),e?h[t][i]=n:h[i][t]=n}}return r},m=null,F=null,x=0,S=0,b=null,E="white",k="#FFFFE0",A="#808080",B="#808080",O=e=>{var r=x-e[0],t=S-e[1];return 0<r&&r<e[2]&&0<t&&t<e[3]},T=(e,r,t,l,i,n)=>(r=e[2]/r,t=e[3]/t,[e[0]+r*l+n,e[1]+t*i+n,r-2*n,t-2*n]),w=(e,r,t)=>{m.fillStyle=r,m.strokeStyle=t,m.fillRect.apply(m,e),m.beginPath(),m.rect.apply(m,e),m.stroke()},N=(e,r,t)=>{m.font=e[3]+"px Sans",m.textAlign="center",m.textBaseline="middle",m.fillStyle=t,m.fillText(r,e[0]+e[2]/2,e[1]+e[3]/2*1.1)},q=(e,r,t,l)=>{m.beginPath(),m.strokeStyle=B,m.lineWidth=2,m.moveTo(e,r),m.lineTo(t,l),m.stroke()},C=e=>{w([0,0,b,b],E,E),q(b/3,0,b/3,b),q(b/3*2,0,b/3*2,b),q(0,b/3,b,b/3),q(0,b/3*2,b,b/3*2);for(var r=0;r<9;r++)for(var t=0;t<9;t++){var l=T([0,0,b,b],9,9,t,r,2),i=(w(l,k,B),h[t][r]),n=y[t][r];if(0==c(i))N(l,"X","#FF4040");else if(0!=u[t][r])N(l,u[t][r],"#404040");else if(0!=n)N(l,n,"#4040F0"),e&&O(l)&&(y[t][r]=0,J());else if(1==c(i))N(l,i[0],A);else for(var o=0;o<3;o++)for(var a=0;a<3;a++){var f=3*o+a+1,s=i.includes(f),m=T(l,3,3,a,o,1);w(m,s?"#FFFF"+Math.floor(100+138/9*c(i)).toString(16):k,"transparent"),N(m,f,s?A:"#E0E0E0"),e&&O(m)&&s&&(y[t][r]=n==f?0:f,J())}}},J=()=>{h=d(n),M()},M=()=>{var e=v();C(!1),0<e&&requestAnimationFrame(M)},R=e=>{var r=F.getBoundingClientRect();x=e.clientX-r.left,S=e.clientY-r.top,C(!0)},P=(e,r)=>{(e=t(e)).style.fontSize=b/27+"px",l(e,"click",e=>{r(),J()})};(body=r("body")).style.margin=0,body.style.textAlign="center",(F=r("canvas")).width=F.height=b=Math.min(body.clientWidth,body.clientHeight)*(26/28),m=F.getContext("2d"),l(F,"click",R),P("l",e),P("c",i),J()</script>