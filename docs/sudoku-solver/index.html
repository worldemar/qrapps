<button id="l">LOCK</button> <button id="c">CLEAR</button><br><canvas><script>var s=e=>JSON.stringify(e),d=e=>JSON.parse(s(e)),o=(e,r)=>s(e)==s(r),c=e=>e.length,r=e=>document.getElementsByTagName(e)[0],t=e=>document.getElementById(e),l=(e,r,t)=>e.addEventListener(r,t),i=(e=(e,r)=>Array(e).fill(r))(9,e(9,0)),a=e(9,e(9,[1,2,3,4,5,6,7,8,9])),n=e(9,e(9,[])),h=d(i),u=d(i),y=d(a),f=(e,r)=>0!=h[e][r]?[h[e][r]]:0!=u[e][r]?[u[e][r]]:y[e][r],e=()=>{h=d(u)},i=()=>{u=d(h),y=d(n)},v=()=>(()=>{for(var e=0,r=0;r<3;r++)for(var t=0;t<3;t++){for(var l=[],i=3*t;i<3*t+3;i++)for(var n=3*r;n<3*r+3;n++)l.push(f(n,i));for(l=g(l,`quad ${r+1},`+(t+1)),i=3*t;i<3*t+3;i++)for(n=3*r;n<3*r+3;n++){var a=l.shift();o(y[n][i],a)||(e+=1),y[n][i]=a}}return e})()+m(!1)+m(!0),g=(e,r)=>{for(var t=c(e),l=d(e),i=0;i<t;i++)if(1==c(e[i]))for(var n,a=0;a<t;a++)a!=i&&-1<(n=l[a].indexOf(e[i][0]))&&l[a].splice(n,1);for(i=0;i<t;i++)if(1<c(e[i])){for(var o=0,f=[],a=0;a<t;a++)s(e[i])==s(e[a])&&(o+=1,f.push(a+1));for(var p=d(e[i]),a=0;a<t;a++)o>=c(p)&&s(l[a])!=s(p)&&(l[a]=l[a].filter(e=>p.indexOf(e)<0)),o>c(p)&&s(e[a])==s(p)&&(l[a]=[])}return l},m=e=>{for(var r=0,t=0;t<9;t++){for(var l=[],i=0;i<9;i++)l.push(e?f(t,i):f(i,t));for(l=g(l,(e?"column ":"row ")+(t+1)),i=0;i<9;i++){var n=l.shift();o(e?y[t][i]:y[i][t],n)||(r+=1),e?y[t][i]=n:y[i][t]=n}}return r},p=null,F=null,x=0,S=0,b=null,E="white",k="#FFFFE0",A="#808080",B="#808080",O=e=>{var r=x-e[0],t=S-e[1];return 0<r&&r<e[2]&&0<t&&t<e[3]},T=(e,r,t,l,i,n)=>(r=e[2]/r,t=e[3]/t,[e[0]+r*l+n,e[1]+t*i+n,r-2*n,t-2*n]),w=(e,r,t)=>{p.fillStyle=r,p.strokeStyle=t,p.fillRect.apply(p,e),p.beginPath(),p.rect.apply(p,e),p.stroke()},M=(e,r,t)=>{p.font=e[3]+"px Sans",p.textAlign="center",p.textBaseline="middle",p.fillStyle=t,p.fillText(r,e[0]+e[2]/2,e[1]+e[3]/2*1.1)},N=(e,r,t,l)=>{p.beginPath(),p.strokeStyle=B,p.lineWidth=2,p.moveTo(e,r),p.lineTo(t,l),p.stroke()},q=e=>{w([0,0,b,b],E,E),N(b/3,0,b/3,b),N(b/3*2,0,b/3*2,b),N(0,b/3,b,b/3),N(0,b/3*2,b,b/3*2);for(var r=0;r<9;r++)for(var t=0;t<9;t++){var l=T([0,0,b,b],9,9,t,r,2),i=(w(l,k,B),y[t][r]),n=u[t][r];if(0==c(i))M(l,"X","#FF4040");else if(0!=h[t][r])M(l,h[t][r],"#404040");else if(0!=n)M(l,n,"#4040F0"),e&&O(l)&&(u[t][r]=0,C());else if(1==c(i))M(l,i[0],A);else for(var a=0;a<3;a++)for(var o=0;o<3;o++){var f=3*a+o+1,s=i.includes(f),p=T(l,3,3,o,a,1);w(p,s?"#FFFF"+Math.floor(100+138/9*c(i)).toString(16):k,"transparent"),M(p,f,s?A:"#E0E0E0"),e&&O(p)&&s&&(u[t][r]=n==f?0:f,C())}}},C=()=>{y=d(a),J()},J=()=>{var e=v();q(!1),0<e&&requestAnimationFrame(J)},R=e=>{var r=F.getBoundingClientRect();x=e.clientX-r.left,S=e.clientY-r.top,q(!0)},P=(e,r)=>{(e=t(e)).style.fontSize=b/27+"px",l(e,"click",e=>{r(),C()})};(body=r("body")).style.margin=0,body.style.textAlign="center",(F=r("canvas")).width=F.height=b=Math.max(720,Math.min(body.clientWidth,body.clientHeight))*(26/28),p=F.getContext("2d"),l(F,"click",R),P("l",e),P("c",i),C()</script>