<style>body{font-family:sans}span{background:tan}.b,a{border-radius:2px;border:1px solid grey}button{width:24px;height:24px;font-size:16px}.s{background:#ff0}.d{background:orange}.l{width:72px;height:72px;font-size:48px}</style><script>for(var c=e=>JSON.stringify(e),d=e=>JSON.parse(c(e)),f=(e,s)=>c(e)==c(s),$=e=>e.length,o=(e,s)=>e.innerHTML=s,s=(e=(e,s)=>Array(e).fill(s))(9,e(9,0)),a=e(9,e(9,[1,2,3,4,5,6,7,8,9])),e=e(9,e(9,[])),t=d(s),i=d(s),u=d(a),v=d(e),p=(e,s)=>0!=t[e][s]?[t[e][s]]:0!=i[e][s]?[i[e][s]]:u[e][s],b=(e,s,a)=>{for(var r=$(e),n=d(e),o=d(s),l=0;l<r;l++)if(1==$(e[l]))for(var t,i=0;i<r;i++)i!=l&&-1<(t=n[i].indexOf(e[l][0]))&&(n[i].splice(t,1),p=e[l][0]+` already set in ${a} - position `+(l+1),o[i].includes(p)||o[i].push(p));for(l=0;l<r;l++)if(1<$(e[l])){for(var u=0,f=[],i=0;i<r;i++)c(e[l])==c(e[i])&&(u+=1,f.push(i+1));for(var v=d(e[l]),i=0;i<r;i++){var p="";u>=$(v)&&c(n[i])!=c(v)&&(n[i]=n[i].filter(e=>v.indexOf(e)<0),p=`set ${v} already fully satisfied in ${a} - positions `+f),u>$(v)&&c(e[i])==c(v)&&(n[i]=[],p=`set ${v} repeats too much: ${u} times`),p&&!o[i].includes(p)&&o[i].push(p)}}return{new_values:n,new_explanations:o}},r=()=>{for(var e=0,s=0;s<3;s++)for(var a=0;a<3;a++){for(var r=[],n=[],o=3*a;o<3*a+3;o++)for(var l=3*s;l<3*s+3;l++)r.push(p(l,o)),n.push(v[l][o]);for(var t=b(r,n,`quad ${s+1},`+(a+1)),r=t.new_values,n=t.new_explanations,o=3*a;o<3*a+3;o++)for(l=3*s;l<3*s+3;l++){var i=r.shift();f(u[l][o],i)||(e+=1),u[l][o]=i,v[l][o]=n.shift()}}return e},n=e=>{for(var s=0,a=0;a<9;a++){for(var r=[],n=[],o=0;o<9;o++)r.push(e?p(a,o):p(o,a)),n.push(e?v[a][o]:v[o][a]);for(var l=b(r,n,(e?"column ":"row ")+(a+1)),r=l.new_values,n=l.new_explanations,o=0;o<9;o++){var t=r.shift();f(e?u[a][o]:u[o][a],t)||(s+=1),e?(u[a][o]=t,v[a][o]=n.shift()):(u[o][a]=t,v[o][a]=n.shift())}}return s},h=(e,s,a,r,n,o,l)=>`<button title="${l.join("\n")}" class="${a}" onclick=b_c(${e},${s},${r}) type=button ${n?"disabled":""}>${o}</button>`,l=(e,s)=>{var a=document.getElementById("c"+e+s);if(0!=t[e][s])o(a,h(e,s,"l",0,!0,t[e][s],[]));else if(0!=i[e][s])o(a,h(e,s,"l",0,!1,i[e][s],[]));else if(values=u[e][s],explanations=v[e][s],0==$(values))o(a,h(e,s,"l",0,!0,"X",explanations));else{for(var r="",n=1;n<=9;n++)var l="b "+(values.includes(n)?["s","d"][$(values)-1]:[]),r=r+h(e,s,l,n,!values.includes(n),n,explanations)+(n%3==0?"<br/>":"");o(a,r)}},m=()=>{for(var e=r()+n(!1)+n(!0),s=0;s<9;s++)for(var a=0;a<9;a++)l(a,s);0<e&&requestAnimationFrame(m)},y="<a class=s>&emsp;</a> = one option left&nbsp;<a class=d>&emsp;</a> = two options left&nbsp;<a class=b onclick=b_l()>Freeze resolved values</a>&nbsp;<a class=b onclick=b_e()>Clear solution</a>",_=0;_<9;_++)for(var w=0;w<9;w++)y+=`<span style="position: absolute; left: ${16+2*(w-w%3)+74*w}; top: ${32+2*(_-_%3)+74*_}" class=cell id=c${w}${_}></span>`;o(document.getElementsByTagName("body")[0],y),m()</script>